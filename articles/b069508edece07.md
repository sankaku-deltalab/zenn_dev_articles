---
title: "Windows10 + Phoenix LiveView + VSCode + WSL2 + Docker ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹æ‰‹é †"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["elixir", "phoenix", "liveview"]
published: false
---

Phoenix ã§ã¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ï¼‰PostgreSQL ã‚’ä½¿ã†ã®ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã„ãŸã„ãŒã€Windows ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã†å ´åˆã€ç´ æœ´ãªã‚„ã‚Šæ–¹ã ã¨ [Hot Reload ç³»ãŒæ©Ÿèƒ½ã—ãªã„](https://github.com/phoenixframework/phoenix/issues/1108)ã€‚
ãã®ãŸã‚ã€WSL2 ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã«ã¤ãªã’ã‚‹ã“ã¨ã§ã€ Hot Reload ã‚’æ©Ÿèƒ½ã•ã›ã‚‹ã€‚
ã¾ãŸã€VSCode ã® [Remote Development](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack) ã‚’ä½¿ã†ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ç°¡å˜ã«è¡Œã†ã€‚

## é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

- é–‹ç™ºç’°å¢ƒã§ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã†å ´åˆã€VSCode ã® [Remote Development](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack) ã‚’ä½¿ã†ã¨æ¥½ã€‚
  - ãŸã ã—ã€ wsl2 ä¸­ã§ `Remote-Containers: Add Development Container Configuration Files...` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
- é–‹ç™ºç’°å¢ƒã§ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã†å ´åˆã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒWindows ä¸­ã«ã‚ã‚‹ã¨ Hot reload ç³»ãŒæ©Ÿèƒ½ã—ãªã„ã€‚ãã®ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ wsl2 ä¸­ã«ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
  - å‚è€ƒ: https://levelup.gitconnected.com/docker-desktop-on-wsl2-the-problem-with-mixing-file-systems-a8b5dcd79b22

## å‰æº–å‚™

- Windows
  - [wsl2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦è¨­å®šã™ã‚‹ã€‚](https://docs.microsoft.com/ja-jp/windows/wsl/install)
    - ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ Ubuntu 22.4 ã«ã™ã‚‹ã€‚
    - å‚è€ƒ: https://qiita.com/zazaza/items/013ad0b0d06bd0bef326
  - VSCode ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ [Remote Development](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack) ã‚’å…¥ã‚Œã‚‹ã€‚
  - [Docker Desktop ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦è¨­å®šã™ã‚‹ã€‚](https://docs.docker.com/desktop/install/windows-install/)

## å¤§ã¾ã‹ãªæ‰‹é †

1. Windows ä¸­ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã‚’ã™ã‚‹ã€‚
2. WSL2 ä¸­ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€Windows ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã‚’ WSL2 ã®æ–¹ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚
3. WSL2 ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã™ã‚‹ã€‚
4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« Phoenix ã‚’å…¥ã‚Œã‚‹ã€‚

## æ‰‹é †

ã“ã“ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åå‰ã‚’ `MyApp` ã¨ã™ã‚‹ã€‚

1. Windows ä¸­ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ VSCode ã§é–‹ãã€‚
   1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `my_app/` ã‚’ä½œæˆã™ã‚‹ã€‚
      1. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã¯ä½¿ã‚ãªã„ã®ã§ã€é©å½“ãªä½ç½®ã§ã„ã„ã€‚
   2. `my_app/` ã§ VSCode ã‚’é–‹ã (`code my_app/`).
2. ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã‚’ã™ã‚‹ã€‚
   1. VSCode ã§ Command Palette (Ctrl + Shift + P) ã‚’é–‹ãã€ `Remote-Containers: Add Development Container Configuration Files...` ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
   2. `Show All Definitions...` -> `Elixir, Phoenix, Node.js & PostgresSQL` ã‚’é¸ã¶ã€‚
   3. `.devcontainer/docker-compose.yml` ã‚’ç·¨é›†ã™ã‚‹ã€‚
      1. `services.db.environment.POSTGRES_DB` ã‚’ `my_app_dev` ã¸å¤‰æ›´ã™ã‚‹ã€‚
      2. ï¼ˆä»»æ„ï¼‰`services.elixir.build.args` ã‚’ç·¨é›†ã—ã¦ Elixir ç­‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰ãˆã‚‹ã€‚
   4. ãã®ä»–ä»»æ„ã§è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã€‚
3. WSL2 ä¸­ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ VSCode ã§é–‹ãã€‚
   1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `my_app/` ã‚’ä½œæˆã™ã‚‹ã€‚
      1. `/mnt/c/` ä»¥ä¸‹ã«ä½œæˆã™ã‚‹ã¨ Windows ä¸­ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€åˆ¥ã®å ´æ‰€ã«ä½œã‚‹ã€‚
   2. `my_app/` ã§ VSCode ã‚’é–‹ã (`code my_app/`).
      1. ã“ã®ã¨ãã€ VSCode ã¯ WSL2 ã«æ¥ç¶šã•ã‚Œã¦ã„ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
      VSCode ã®å·¦ä¸‹ã«ã‚ã‚‹ç·‘ã®ã‚¢ã‚¤ã‚³ãƒ³ã« `WSL: Ubuntu-22.04` ã¨æ›¸ã‹ã‚Œã¦ãªã„ãªã‚‰ã€ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ `Reopen Folder in WSL` -> `Ubuntu-22.04` ã‚’é¸ã¶ã“ã¨ã§ã€ WSL2 ã«æ¥ç¶šã—ãŸçŠ¶æ…‹ã§ VSCode ã‚’é–‹ã‘ã‚‹ã€‚
      ![WSL2 ã«æ¥ç¶šã—ã¦ã„ã‚‹ VSCode ã®å¤–è¦³](/images/b069508edece07/vscode_connects_wsl.jpg)
4. Windows ä¸­ã® `my_app/.devcontainer/` ã‚’ WSL2 ä¸­ã® `my_app/.devcontainer/` ã¸ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚
   1. Windows ã® `\\wsl$\Ubuntu-22.04\` ä»¥ä¸‹ã« Ubuntu ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹ã®ã§ã€ãã“ã¸ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚
   2. ã‚³ãƒ”ãƒ¼ãŒã§ããªã„ãªã‚‰ã€Windows ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã« push ã—ã€ WSL2 ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãã‚Œã‚’ pull ã—ã¦ã‚‚ã„ã„ã€‚
5. ï¼ˆä»»æ„ï¼‰Windows ä¸­ã® `my_app/` ã¯ã‚‚ã†ä½¿ã‚ãªã„ã®ã§æ¶ˆã™ã€‚
6. WSL2 ã«æ¥ç¶šã—ã¦ã„ã‚‹ VSCode ã§ã€Command Palette ã‹ã‚‰ã€ `Remote-Containers: Rebuild and Reopen in Container` ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
   1. 2022-08-16 æ™‚ç‚¹ã€ãªãœã‹ `https://raw.githubusercontent.com/microsoft/vscode-dev-containers/v0.245.0/script-library/common-debian.sh` ã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ ãŒåˆã‚ãªã‹ã£ãŸãŸã‚ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€è‡ªå‰ã§ SHA-256 ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’è¨ˆç®—ã—ã¦ `.devcontainer/Dockerfile` ã® COMMON_SCRIPT_SHA ã‚’æ›¸ãæ›ãˆãŸã€‚
7. Phoenix ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã€‚
   1. `mix phx.new . --app my_app` ã‚’å®Ÿè¡Œã€‚
      1. `--live` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä»Šã¯ã„ã‚‰ãªã„ã€‚
   2. ï¼ˆä»»æ„ï¼‰`./mix.exs` ã® `project` é–¢æ•°å†…ã«ã‚ã‚‹ `compilers` ã‹ã‚‰ `:gettext` ã‚’æ¶ˆã™ã€‚
   3. `mix ecto.create` ã‚’å®Ÿè¡Œã€‚
   4. `mix phx.server` ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ `localhost:4000` ã‚’èª­ã‚€ã€‚
   5. `./liv/my_app_web/templates/page/index.html.heex` ã‚’é©å½“ã«å¤‰æ›´ã—ã€LiveReload ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
      1. heex ã‚’å¤‰æ›´ã—ã¦ã‚‚ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®è¡¨ç¤ºãŒå¤‰ã‚ã‚‰ãªã„ãªã‚‰ã€ LiveReload ã¯æ©Ÿèƒ½ã—ã¦ã„ãªã„ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ WSL2 ä¸­ã§ãªã Windows ä¸­ã«ã‚ã‚‹ã¨æ€ã‚ã‚Œã‚‹ã€‚
8. ï¼ˆä»»æ„ï¼‰Tailwind CSS ã‚’å…¥ã‚Œã‚‹ã€‚
   1. [å…¬å¼ã®è¨˜äº‹ã‚’è¦‹ã¦Tailwind CSS ã‚’å…¥ã‚Œã‚‹ã€‚](https://tailwindcss.com/docs/guides/phoenix)
9. ï¼ˆä»»æ„ï¼‰Tailwind CSS ã«åŠ ãˆã¦ daisyUI ã‚’å…¥ã‚Œã‚‹ã€‚
   1. `my_app/assets` ã«ç§»å‹•ã—ã€ `npm i daisyui` ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
   2. `my_app/mix.exs` ã«ã‚ã‚‹ `aliases` é–¢æ•°ã® `setup` ã«ã€ `~S{run -e 'System.cmd("npm", ["install"], cd: "./assets")' }` ã‚’åŠ ãˆã‚‹ã€‚
   `setup: [...],` -> `setup: [..., ~S{run -e 'System.cmd("npm", ["install"], cd: "./assets")' }],`
